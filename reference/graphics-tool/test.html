<!DOCTYPE html>
<html>
    <body>
        <script type="text/javascript">


if ('serviceWorker' in navigator) {
  window.addEventListener('load', function() {
    console.log('load 3')
    // navigator.serviceWorker.unregister()

    navigator.serviceWorker.register('sw.js')
    .then((registration) => {

        // setTimeout(() => {
        //     console.log('unregister')
        //     registration.unregister()
        // }, 2000)

      console.log('Service worker registered with scope: ', registration.scope);


    }, (err) => {
      console.log('ServiceWorker registration failed: ', err);
    });
  });
}



async function main() {
    const dirHandle = await window.showDirectoryPicker({
        id: "graphics-tool",
        mode: "read"
    })
    console.log('dirHandle', dirHandle)

    for await (const [key, handle] of dirHandle.entries()) {
        console.log(key, handle)
        const file = await handle.getFile()
        console.log('file', file)


        // file.type // mime type
        // file.size

        // Read file content to a buffer.
        // const buffer = new DataView(new ArrayBuffer(file.size));
        // const readBuffer = accessHandle.read(buffer, { at: 0 });

        const arrayBuffer = await file.arrayBuffer()
        console.log('arrayBuffer', arrayBuffer)

        // const stream = await file.stream()
        // console.log('stream', stream)
        // const buffer = await new Promise((resolve, reject) => {
        //     const _buf = []
        //     stream.on("data", (chunk) => _buf.push(chunk));
        //     stream.on("end", () => resolve(Buffer.concat(_buf)));
        //     stream.on("error", (err) => reject(err));
        // })

        // console.log('buffer', buffer)
    }

}

// setTimeout(() => {
//     fetch('LOCAL/test.txt').then((response) => {
//         console.log('fetch  success')
//         return response.text()
//     })
//     .then((text) => {
//         console.log('fetch  text', text)

//         const img = document.createElement('img')
//         img.src = 'LOCAL/cat.jpg'
//         document.body.appendChild(img)
//     })
//     .catch(() => {
//         console.log('fetch  failed')
//     })
// }, 1000)

        </script>
        <button onclick="main().catch(console.error)">GO!</button>
    </body>
</html>
